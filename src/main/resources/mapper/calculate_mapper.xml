<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="co.cod.app.calculate.mapper.CalculateMapper">
	<select id="dayCalculate" statementType="CALLABLE">
      { call p_calculate(
       #{dayPay, mode=OUT, jdbcType=VARCHAR},
       #{calculatePay, mode=OUT, jdbcType=VARCHAR},
       #{adminId}
      )}
   	</select>
   	<select id="commuteList" parameterType="String" resultType="map">
   		SELECT * 
   		  FROM commute_views
   		 WHERE admin_id = #{adminId}
   		 ORDER BY commute_day desc
   	</select>
   	
   	<select id="calculateList" parameterType="calculate" resultType="calculate">
        SELECT TRUNC(O.ORDER_TIME) "ORDER_TIME", 
                SUM((M.PRICE + M.PRICE_ADD * OL.ORDER_STATE )*OL.ORDERLINE_AMOUNT) PRICE
          FROM ORDERS O, ORDERLINE OL, MENU M
         WHERE O.ORDER_SEQ = OL.ORDER_SEQ
           AND OL.MENU_SEQ = M.MENU_SEQ
           AND O.ADMIN_ID =#{adminId}
         <if test = "startTime != null and startTime !='' and endTime =='' ">
	        AND TO_CHAR(O.ORDER_TIME,'yyyy-MM-dd') = #{startTime}
	     </if>
	     <if test="startTime != null and startTime !='' and endTime != null and endTime !=''">
	     	AND    TO_CHAR(O.ORDER_TIME,'yyyy-MM-dd') BETWEEN #{startTime} and #{endTime}
	     </if>
         GROUP BY TRUNC(O.ORDER_TIME)
         ORDER BY 1 DESC
     </select> 
     <select id="getcalculateList" parameterType="calculate" resultType="map">
	     SELECT *       
	       FROM order_view
	      WHERE admin_id= #{adminId}
	        AND trunc(order_time) = #{orderTime}
     </select>
</mapper>