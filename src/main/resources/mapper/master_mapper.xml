<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- dumy_mapper.xml -->

<!-- MESSAGE -->
<mapper namespace="co.cod.app.master.mapper.MasterMapper">

	<insert id="insertMaster" parameterType="vofile.MasterVO" >
	INSERT INTO ADMIN (
		ADMIN_ID,
		PW,
		PASS2,
		ADMIN_PHONE,
		CAFE_STATE, 
		ADMIN_STATE)
		VALUES ( 
		#{adminId}, 
		#{pw},
		#{pass2}, 
		#{adminPhone},	
		0,	
		1
		)	
	</insert>
	
	<select id="MasterList" resultType="vofile.MasterVO" >
		SELECT * FROM ADMIN WHERE ADMIN_STATE = '1' 
	</select>
	
	<select id="getFiveMessage" resultType="vofile.MessageVO">
	SELECT * 
	  FROM (SELECT * 
			 FROM MESSAGE
			WHERE SEND_RECEIVE =1 
		      AND MASTER_SEND=0 
	     ORDER BY MESSAGE_SEQ DESC) 
	  WHERE <![CDATA[rownum <= 5]]>
	</select>
	
	<select id="masterMessage" resultType="vofile.MessageVO"> 
	SELECT * FROM MESSAGE
	WHERE SEND_RECEIVE =1 AND MASTER_SEND=0
	</select>	
	
	<select id="sendMasterMessage" resultType="vofile.MessageVO">
	SELECT * FROM MESSAGE
	WHERE SEND_RECEIVE =1 AND MASTER_SEND=1
	</select>
	
	<select id="receiveMasterMessage" resultType="vofile.MessageVO">
	SELECT * FROM MESSAGE
	WHERE SEND_RECEIVE =1 AND MASTER_SEND=0
	</select>

	<select id="getMasterMessageCount" resultType="int">
		 SELECT NVL(COUNT(MASTER_READ),0) FROM MESSAGE
		WHERE MASTER_READ=1 AND SEND_RECEIVE =1 AND MASTER_SEND =0
	</select>
	
	<select id="getMasterMessage" resultType="vofile.MasterVO" parameterType="vofile.MasterVO">
		SELECT
			MESSAGE_TITLE, 
			MESSAGE_CONTENT, 
			READ 
		  FROM MESSAGE WHERE MESSAGE_SEQ =#{messageSeq}
	</select>
	
	<update id="updateMessage" parameterType="int">  <!-- 메세지 읽음, 읽지않음 -->
		UPDATE MESSAGE
		SET
		MASTER_READ=0
		WHERE MESSAGE_SEQ=#{messageSeq}
	</update>
	
	<insert id="insertMasterMessage" parameterType="vofile.MessageVO">
		INSERT INTO MESSAGE(
						MESSAGE_SEQ,
						MESSAGE_TITLE,
						MESSAGE_CONTENT,
						SEND_RECEIVE,
						MESSAGE_DATE,
						ADMIN_ID,
						READ,
						MASTER_READ)
		VALUES (
						(select nvl(max(message_seq),0)+1 from message),
						#{messageTitle},
						#{messageContent},
						0,
						SYSDATE,
						#{adminId},
						1,
						0
		)
	</insert>	
<!--  마스터가 Admin 이 보낸 카페 등록 폼에서 승인을 누를시 cafe_state 가 0에서 2로 바꿈  -->


<!-- 마스터 올 리스트  -->

<select id="allList" resultType="map">
	SELECT
		(SELECT COUNT(*) FROM MEMBER) "M" ,
		(SELECT COUNT(*) FROM ADMIN WHERE CAFE_STATE =1) "C1",
		(SELECT COUNT(*) FROM ADMIN WHERE CAFE_STATE =2) "C2",
		(SELECT COUNT(*) FROM ADVERTISEMENT WHERE ADVERTISE_STATE=1) "A1"
		
		
	FROM DUAL
</select>


</mapper>
